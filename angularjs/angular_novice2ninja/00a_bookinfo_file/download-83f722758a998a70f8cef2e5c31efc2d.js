$(document).ready(function(){"use strict";$("a.js-modal-download-trigger").on("click",function(e){function f(){i.html('<p class="text-center" style="margin-bottom:0">Loading ...</p>')}function l(){i.html("Error! Please try again.")}function c(e){if(e.formats)return h(e);var t=[];e.credit_balance==0?(e.trialling&&e.trial_plan_credits==0?t.push("Your trial does not include downloads."):e.membership_plan_credits==0?t.push("Your plan does not include downloads."):e.credit_limit?t.push("Oh no! You already used your "+e.credit_limit+" downloads this month."):t.push("Oh no! You’re out of download credits."),e.renewal_date&&!e.trialling&&t.push("You’ll receive "+e.membership_plan_credits+" new download credits on "+e.renewal_date+".")):(e.trialling&&t.push("You’re currently on a trial which limits you to "+e.trial_plan_credits+" free download(s)."),e.credit_balance==1?t.push("This will use your download credit."):t.push("This will use 1 of your download credits."),t.push('<a href="'+e.unlock_action+'" class="button" data-unlock-action>Confirm Download</a>'),e.credit_limit?t.push("You get up to "+e.credit_limit+" downloads every month. You have "+e.credit_balance+" left."):t.push("You have "+e.credit_balance+" download credits.")),e.trialling&&(e.credit_limit?t.push("Your trial will convert to a paid plan on "+e.renewal_date+", and will include up to "+e.credit_limit+" downloads each month."):e.membership_plan_unlimited?t.push("Your trial will convert to a paid plan on "+e.renewal_date+", and will include unlimited downloads each month."):t.push("Your trial will convert to a paid plan on "+e.renewal_date+", and will include "+e.membership_plan_credits+" downloads each month.")),e.membership_plan_unlimited||t.push('<a href="'+e.upgrade_action+'">Upgrade for unlimited downloads</a>');var n="";$.each(t,function(e,t){n+="<p>"+t+"</p>"}),i.html(n)}function h(e){var t="<h2>Download "+e.title+"</h2>";e.instructions&&(t+="<p>"+e.instructions+"</p>"),$.each(e.formats,function(e,n){t+='<div class="row collapse"><div class="columns large-5"><a href="'+n.url+'" class="button '+(n.available_offline?"start":"")+' download-get" target="_blank">'+n.name+'</a></div><div class="columns large-10"><p class="media-description">'+n.description+"</p></div></div>"}),i.html(t)}function p(e){f(),$.ajax({type:"GET",url:e}).done(c).fail(l)}function d(e){f(),$.ajax({type:"POST",url:e,headers:{"X-Transaction":"POST","X-CSRF-Token":s}}).done(function(e){t.data("downloadable","true"),h(e)}).fail(l)}function v(e){f(),$.ajax({type:"GET",url:e}).done(h).fail(l)}e.stopImmediatePropagation(),e.preventDefault();var t=$(e.target),n=$('meta[name="csrf-token"]'),r=$("#modal-download"),i=r.find(".content"),s=n.attr("content"),o=t.data("downloadable"),u=t.data("download-formats-url"),a=t.attr("href");r.one("opened",function(e){o?v(u):p(a)}),r.one("click","a[data-unlock-action]",function(e){e.stopImmediatePropagation(),e.preventDefault(),d($(e.target).attr("href"))}),r.foundation("reveal","open")})});